<!DOCTYPE html>
<html>
<head>
    <title>Мой Простой Чат</title>
</head>
<body>

    <ul id="messages" style="list-style-type: none; padding: 0;"></ul>
    
    <form id="chat" action="" style="position: fixed; bottom: 0;">
        <input id="username" autocomplete="off" placeholder="Имя" style="width: 100px;" />
        <input id="m" autocomplete="off" placeholder="Сообщение..." style="width: 250px;" />
        <button>Отправить</button>
    </form>

    <script src="/socket.io/socket.io.js"></script> 
    
    <script>
        // 1. Устанавливаем соединение с сервером
        const socket = io(); 
        
        // Получаем ссылки на элементы страницы
        const form = document.getElementById('chat');
        const inputMessage = document.getElementById('m');
        const inputUsername = document.getElementById('username');
        const messages = document.getElementById('messages');

        // 2. Обработка отправки сообщения
        form.addEventListener('submit', function(e) {
            e.preventDefault(); // Запрещаем перезагрузку страницы
            
            const username = inputUsername.value.trim() || 'Гость';
            const message = inputMessage.value.trim();
            
            if (message) {
                const fullMessage = `${username}: ${message}`;
                // Отправляем на сервер по каналу 'chat message'
                socket.emit('chat message', fullMessage); 
                inputMessage.value = ''; // Очищаем поле ввода
            }
        });

        // 3. Обработка получения сообщения от сервера
        socket.on('chat message', function(msg) {
            const item = document.createElement('li'); // Создаем новый элемент списка
            item.textContent = msg;
            messages.appendChild(item); // Добавляем сообщение в чат
            window.scrollTo(0, document.body.scrollHeight); // Прокрутка вниз
        });
    </script>

</body>
</html>